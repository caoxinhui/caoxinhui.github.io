---
title: 发布订阅模式
date: 2020-04-11 21:28:50
tags:
categories: 设计模式
---

本文简单介绍发布订阅模式的实际应用
<!-- more -->


实现一个简单的createStore函数
```js
const createStore = (reducer) => {
    let state
    const listerners = []
    const getState = () => state
    const dispatch = (action) => {
        state = reducer(state, action)
        listerners.forEach(listerner => listerner())
    }
    const subscribe = function (listener) {
        listeners.push(listener)
        return function () {
            listerners = listerners.filter(l => l !== listener)
        }
    }
    dispatch()
    return {
        getState,
        dispatch,
        subscribe
    }
}

const reducer = (state = {}, action) => {
    switch (action.type) {
        case 'INCREMENT': {
            return {
                ...state,
            ++state.count
        }
        default:
            return state
        }
    }
}

const store = createStore(reducer)
const render = () => {
    document.body.innerText = store.getState().count
}

store.subscribe(render)
render()
const INCREASE_ACTION = {type: 'INCREMENT'}
document.addEventListener('click', function (e) {
    store.dispatch(INCREASE_ACTION)
})
```