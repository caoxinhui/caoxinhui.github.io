---
title: 防抖和节流
date: 2020-03-12 23:04:36
tags:
categories: 基础
---

### 防抖
>你尽管触发事件，但是我一定在事件触发 n 秒后才执行，如果你在一个事件触发的 n 秒内又触发了这个事件，那我就以新的事件的时间为准，n 秒后才执行，总之，就是要等你触发完事件 n 秒内不再触发事件

```html
<!DOCTYPE html>
<html>
<head>

</head>
<body>
<div id="container" style="width: 100px;height: 100px;border: 1px solid red"></div>
<script>
    let count = 0
    const container = document.querySelector('#container')
    function getUserAction(){
        this.innerHTML = count++
    }
    function debounce(fn){
        let timer
        return function () {
            const context = this
            clearTimeout(timer)
            timer = setTimeout(()=>{
                fn.apply(context,arguments)
            },1000)
        }
    }
    container.onmousemove = debounce(getUserAction)
</script>
</body>
</html>
```

### 节流
> 如果你持续触发事件，每隔一段时间，只执行一次事件


#### 使用时间戳

```js
<!DOCTYPE html>
<html>
<head>

</head>
<body>
<div id="container" style="width: 100px;height: 100px;border: 1px solid red"></div>
<script>
    let count = 0
    const container = document.querySelector('#container')
    function getUserAction(){
        this.innerHTML = count++
    }
    function throttle(fn){
        let previous = 0
        let context,args
        return function () {
            let now = new Date()
            context = this
            args = arguments
            if(now-previous>1000){
                fn.apply(context,args)
                previous = now
            }
        }
    }
    container.onmousemove = debounce(getUserAction)
</script>
</body>
</html>
```
#### 使用定时器

```html
<!DOCTYPE html>
<html>
<head>

</head>
<body>
<div id="container" style="width: 100px;height: 100px;border: 1px solid red"></div>
<script>
    let count = 0
    const container = document.querySelector('#container')
    function getUserAction(){
        this.innerHTML = count++
    }
    function throttle(fn){
        let previous = 0
        let timeout
        return function () {
            let now = new Date()
            context = this
            args = arguments
            if(!timeout){
                timeout = setTimeout(()=>{
                    timeout = null
                    fn.apply(context,args)
                },1000)
            }
        }
    }
    container.onmousemove = throttle(getUserAction)
</script>
</body>
</html>
```