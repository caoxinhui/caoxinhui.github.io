---
title: é¡¹ç›®è¸©å‘
date: 2020-02-17 11:46:15
tags: é¡¹ç›®ç»å†
---

æœ€è¿‘å‘ç°ï¼Œé¡¹ç›®é‡æ„çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå®¹æ˜“å‡ºbug
- é¡¹ç›®é‡æ„ç›¸è¾ƒäºé¡¹ç›® init ï¼Œä¸ä¼šé‚£ä¹ˆè°¨æ…ã€‚é€ æˆæ¼æ´
- æµ‹è¯•èµ„æºä¹Ÿæ²¡æœ‰åˆç†åˆ†é…ï¼Œå¯¼è‡´é¡¹ç›®é‡æ„äº†ï¼Œå´æ²¡æœ‰ç»è¿‡æµ‹è¯•ã€‚

ä¸»è¦é€»è¾‘æ¯”è¾ƒé‡çš„éƒ¨åˆ†åœ¨äºï¼šä¼˜æƒ åˆ¸ å’Œ å€’è®¡æ—¶

- DOM ref ä»€ä¹ˆæ—¶å€™ä¼šå˜åŒ–ï¼Œæ„Ÿè§‰ç”¨useEffectç›‘å¬ ref çš„å˜åŒ–ï¼Œå¹¶ä½œå‡ºç›¸åº”ç›‘å¬åŠ¨ä½œæ²¡æœ‰å¿…è¦ï¼Œå› ä¸ºdom ref å¾ˆå°‘éœ€è¦æ”¹å˜çš„ã€‚


### å¼¹å‡ºè’™å±‚åï¼Œé¡µé¢ç¦æ­¢æ»šåŠ¨

ğŸ‘‡å°†é¡µé¢å›ºå®š
```js
const bodyEl = document.querySelector("body");
bodyEl.style.position = "fixed";
```

ğŸ¤”ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜å•Šï¼Œä»¥ä¸Šæ–¹æ³•å°† body ä½ç½®å›ºå®šï¼Œé¡µé¢ä¼šè‡ªåŠ¨åˆ’åˆ°æœ€é¡¶ä¸Šã€‚
ğŸ‘‰æ‰€ä»¥å…ˆè®°å½•ä¸‹å½“å‰é¡µé¢çš„æ»šåŠ¨è·ç¦»ï¼Œåœ¨ body æ ·å¼è®¾ç½®ä¸º fixed ä¹‹åï¼Œä¿®æ”¹ body çš„ top å€¼ã€‚

```js
  const bodyEl = document.querySelector("body");
  bodyEl.style.position = "fixe
  bodyEl.styld";e.width = "100%";
  bodyEl.style.top = -top + "px";
```

è¯¥æ–¹æ³•ï¼Œèƒ½ä½¿è’™å±‚é‡Œé¢çš„å†…å®¹ç¦æ­¢æ»šåŠ¨ï¼Œè€Œä¸å½±å“è’™å±‚å¤–é¢çš„å¯æ»šåŠ¨åŒºåŸŸ

å½“éœ€è¦å…³é—­è’™å±‚æ—¶ï¼ŒæŠŠä¸€åˆ‡å¤åŸï¼ŒåŒæ—¶ï¼Œè¿˜æœ‰æ»šåŠ¨åˆ°åŸå…ˆçš„ä½ç½®

```js
  const bodyEl = document.querySelector("body");
  const top = -bodyEl.style.top.split("px")[0];
  bodyEl.style.position = "";
  bodyEl.style.top = "";
  window.scrollTo(0, top);
```

componentWillCreate é‡Œé¢è¯·æ±‚æ•°æ®ï¼Œè¯·æ±‚è¶…æ—¶ã€‚ç»è¿‡äº†æ€æ ·çš„è¿‡ç¨‹ã€‚ä¸ºä»€ä¹ˆé¡µé¢è¿‡ä¸€æ®µæ—¶é—´åæ˜¯ç™½å±ã€‚


### Provisional headers are shown


### Promise æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚

```js
  async function getData1 () {
    return new Promise(function (resolve, reject) {
      setTimeout(() => {
        resolve([])
      }, 1000)
    })
  }
```

é€šè¿‡ä½¿ç”¨ promise æ¨¡æ‹Ÿæ¥å£å¼‚å¸¸ï¼Œè¶…æ—¶ï¼Œå¯ä»¥å‘ç°ï¼Œå¦‚æœå°† getData1 æ“ä½œæ”¾åœ¨æœåŠ¡ç«¯è¿›è¡Œï¼ˆcomponentWillCreateï¼‰ï¼Œé‚£ä¹ˆï¼Œé¡µé¢ loading çš„è¿‡ç¨‹éœ€è¦ 10sï¼Œåœ¨è¿™ 10s çš„è¿‡ç¨‹ä¸­ï¼Œé¡µé¢å§‹ç»ˆæ˜¯ loadingçŠ¶æ€ï¼Œé¡µé¢ç™½å±ï¼Œè¦ç­‰ 10s ç­‰å¾…ç»“æŸï¼Œæ‰ä¼šå‡ºç°é¦–å±ã€‚

è€Œå¦‚æœæ”¾åœ¨ componentDidFirstMountä¸­æ‰§è¡Œï¼Œé¦–å±å†…å®¹å¿«é€ŸåŠ è½½ã€‚ä½†æ˜¯è¦ç­‰åˆ° 10s ä¹‹åï¼Œæ‰ä¼šè¯·æ±‚å…¶ä»–æ¥å£ã€‚

ğŸ¤”é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå°†è¯·æ±‚ getData1 çš„è¯·æ±‚æ”¾åœ¨ componentDidFirstMount ä¸­ï¼Œç«‹å³æ‰§è¡Œï¼Œç»„ä»¶ä¸­Visibility Change äº‹ä»¶ä¼šç­‰ getData1 å‡½æ•°å®Œå…¨æ‰§è¡Œå®Œï¼Œæ‰ä¼šæ‰§è¡Œã€‚
ä½†æ˜¯å½“ï¼Œå°† getData1 è¯·æ±‚æ”¾åœ¨ componentDidFirstMount çš„æœ€åä¸€æ­¥ã€‚è™½ç„¶ getData1 ä¹Ÿä¼šä¼˜å…ˆæ‰§è¡Œï¼Œä½†æ˜¯åœ¨ getData1 ç»“æœè¿”å›ä¹‹å‰ï¼ŒVisibility Change äº‹ä»¶ä¹Ÿè§¦å‘äº†ã€‚

åœ¨ componentDidFirstMountä¹‹åï¼Œ getData1 å’Œ Visibility Changeå®é™…ä¸Šæ˜¯å¹¶åˆ—æ‰§è¡Œçš„ï¼Œäº’ä¸å½±å“ã€‚


`const [active, setActive] = useState(startToLoad)`ï¼Œå½“ startToLoad å˜åŒ–çš„æ—¶å€™ï¼Œactive æ˜¯å¦ä¼šå˜åŒ–

å¦ï¼ŒstartToLoad åªæ˜¯ç»™ active æä¾›äº†ä¸€ä¸ªåˆå§‹å€¼ï¼Œèµ‹å€¼ç»“æŸåï¼Œæ§åˆ¶æƒäº¤ç»™ setActive